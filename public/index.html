<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Health Tracker</title>

<!-- Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
  /* ===== Common Styles ===== */
  html, body { height:100%; margin:0; padding:0; box-sizing:border-box; font-family:'Segoe UI', Arial, sans-serif;}
  body {min-height:100vh; width:100vw; background:linear-gradient(120deg,#a2d4f6 60%,#023e8a 100%); overflow:hidden; display:flex; align-items:center; justify-content:center; position:relative;}
  body::before, body::after {content:""; position:absolute; border-radius:40% 60% 60% 40% / 60% 40% 60% 40%; opacity:0.33; z-index:0;}
  body::before {top:-100px; left:-100px; width:350px; height:350px; background:#90e0ef;}
  body::after {right:-120px; bottom:-160px; width:400px; height:300px; background:#0077b6;}
  .container {position:relative; z-index:1; width:100%; max-width:425px; margin:auto;}
  .card {background: rgba(255,255,255,0.14); box-shadow: 0 8px 32px 0 rgba(31,38,135,0.18); border-radius:22px; backdrop-filter:blur(14px); -webkit-backdrop-filter:blur(14px); padding:34px 32px 25px 32px; color:#fff; text-align:center; display:none;}
  .card.active {display:block;}
  .logo {font-size:1.1rem; font-weight:600; margin-bottom:17px; color:#fff;}
  h2 {margin:0 0 12px 0; letter-spacing:1px; font-size:2rem; font-weight:600;}
  label {display:block; text-align:left; margin:13px 0 3px 1px; font-size:1.04rem; color:#e0e0e0;}
  input[type="email"], input[type="password"] {width:100%; padding:10px 12px; border-radius:7px; border:none; margin-bottom:7px; background:rgba(255,255,255,0.27); color:#252525; font-size:1rem; outline:none;}
  input::placeholder {color:#bdbdbd;}
  .signin-btn {width:100%; padding:11px 0; background:#023e8a; color:#fff; font-weight:bold; border-radius:7px; border:none; font-size:1.07rem; cursor:pointer; margin-bottom:18px; transition: background 0.18s;}
  .signin-btn:hover {background:#0077b6;}
  .link {color:#48cae4; text-decoration:none; cursor:pointer;}
  #dashboardCards div {background: rgba(255,255,255,0.1); padding:10px; flex:1 1 45%; border-radius:7px; text-align:left;}
  #dashboardCards {display:flex; flex-wrap:wrap; justify-content:space-between; gap:10px; margin-bottom:15px;}
</style>
</head>
<body>

<div class="container">

  <!-- ===== Login Card ===== -->
  <div id="loginCard" class="card active">
    <div class="logo">Your logo</div>
    <h2>Login</h2>
    <form id="loginForm">
      <label for="loginEmail">Email</label>
      <input type="email" id="loginEmail" placeholder="username@gmail.com" required>
      <label for="loginPassword">Password</label>
      <input type="password" id="loginPassword" placeholder="Password" required>
      <button type="submit" class="signin-btn">Sign in</button>
    </form>
    <div class="register">Don't have an account? <span class="link" id="showSignup">Sign Up</span></div>
  </div>

  <!-- ===== Signup Card ===== -->
  <div id="signupCard" class="card">
    <div class="logo">Your logo</div>
    <h2>Sign Up</h2>
    <form id="signupForm">
      <label for="signupEmail">Email</label>
      <input type="email" id="signupEmail" placeholder="username@gmail.com" required>
      <label for="signupPassword">Password</label>
      <input type="password" id="signupPassword" placeholder="Password" required>
      <button type="submit" class="signin-btn">Sign Up</button>
    </form>
    <div class="register">Already have an account? <span class="link" id="showLogin">Login</span></div>
  </div>

  <!-- ===== Dashboard Card ===== -->
  <div id="dashboardCard" class="card">
    <div class="logo">Your logo</div>
    <h2>Dashboard</h2>
    <div id="dashboardCards">Loading records...</div>
    <canvas id="statsChart" height="200"></canvas>
    <button class="signin-btn" id="logoutBtn">Logout</button>
  </div>

</div>

<script>
const API_URL = "https://health-tracker-exp.onrender.com";

// Elements
const loginCard = document.getElementById("loginCard");
const signupCard = document.getElementById("signupCard");
const dashboardCard = document.getElementById("dashboardCard");

const showSignup = document.getElementById("showSignup");
const showLogin = document.getElementById("showLogin");

const loginForm = document.getElementById("loginForm");
const signupForm = document.getElementById("signupForm");

const dashboardCards = document.getElementById("dashboardCards");
const statsChart = document.getElementById("statsChart");
const logoutBtn = document.getElementById("logoutBtn");

// ===== View Switch =====
showSignup.addEventListener("click", ()=>{ loginCard.classList.remove("active"); signupCard.classList.add("active"); });
showLogin.addEventListener("click", ()=>{ signupCard.classList.remove("active"); loginCard.classList.add("active"); });

// ===== Login =====
loginForm.addEventListener("submit", async (e)=>{
  e.preventDefault();
  const username = document.getElementById("loginEmail").value.trim();
  const password = document.getElementById("loginPassword").value.trim();
  try{
    const res = await fetch(`${API_URL}/login`, {
      method:"POST", headers:{"Content-Type":"application/json"}, body:JSON.stringify({username,password})
    });
    const data = await res.json();
    if(data.userId){
      localStorage.setItem("userId", data.userId);
      showDashboard();
    } else alert(data.error || "Login failed");
  }catch(err){ console.error(err); alert("Error connecting to backend"); }
});

// ===== Signup =====
signupForm.addEventListener("submit", async (e)=>{
  e.preventDefault();
  const username = document.getElementById("signupEmail").value.trim();
  const password = document.getElementById("signupPassword").value.trim();
  try{
    const res = await fetch(`${API_URL}/register`, {
      method:"POST", headers:{"Content-Type":"application/json"}, body:JSON.stringify({username,password})
    });
    const data = await res.json();
    if(data.message){
      alert("Signup successful!");
      signupCard.classList.remove("active");
      loginCard.classList.add("active");
    } else alert(data.error || "Signup failed");
  }catch(err){ console.error(err); alert("Error connecting to backend"); }
});

// ===== Dashboard =====
function showDashboard(){
  loginCard.classList.remove("active");
  signupCard.classList.remove("active");
  dashboardCard.classList.add("active");

  const userId = localStorage.getItem("userId");
  if(!userId){ loginCard.classList.add("active"); dashboardCard.classList.remove("active"); return; }

  fetch(`${API_URL}/dashboard/${userId}`)
    .then(res=>res.json())
    .then(data=>{
      if(data.error){
        dashboardCards.innerHTML = `<p>${data.error}</p>`;
      } else if(data.length===0){
        dashboardCards.innerHTML="<p>No records yet.</p>";
      } else {
        // ===== Cards =====
        dashboardCards.innerHTML = data.map(r=>`
          <div>
            <strong>${r.date}</strong><br>
            Water: ${r.water} cups<br>
            Sleep: ${r.sleep} hrs<br>
            Exercise: ${r.exercise} mins<br>
            Study: ${r.study} hrs
          </div>
        `).join("");

        // ===== Chart =====
        const labels = data.map(r=>r.date).reverse();
        const waterData = data.map(r=>r.water).reverse();
        const sleepData = data.map(r=>r.sleep).reverse();
        const exerciseData = data.map(r=>r.exercise).reverse();
        const studyData = data.map(r=>r.study).reverse();

        new Chart(statsChart, {
          type: 'line',
          data: {
            labels,
            datasets: [
              { label: 'Water (cups)', data: waterData, borderColor:'#48cae4', fill:false, tension:0.2 },
              { label: 'Sleep (hrs)', data: sleepData, borderColor:'#023e8a', fill:false, tension:0.2 },
              { label: 'Exercise (mins)', data: exerciseData, borderColor:'#90e0ef', fill:false, tension:0.2 },
              { label: 'Study (hrs)', data: studyData, borderColor:'#0077b6', fill:false, tension:0.2 }
            ]
          },
          options: {
            responsive:true,
            plugins: { legend:{ labels:{ color:'#fff' } } },
            scales:{
              x:{ ticks:{ color:'#fff' }, grid:{ color:'rgba(255,255,255,0.1)' } },
              y:{ ticks:{ color:'#fff' }, grid:{ color:'rgba(255,255,255,0.1)' } }
            }
          }
        });
      }
    }).catch(err=>{ console.error(err); dashboardCards.innerHTML="<p>Error loading dashboard.</p>"; });
}

// ===== Logout =====
logoutBtn.addEventListener("click", ()=>{
  localStorage.removeItem("userId");
  dashboardCard.classList.remove("active");
  loginCard.classList.add("active");
});

// ===== Auto-login if user already logged in =====
if(localStorage.getItem("userId")) showDashboard();
</script>

</body>
</html>
