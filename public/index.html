<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Health Tracker — All-in-One</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-100">

  <!-- ===== Login Page ===== -->
  <div id="loginPage" class="flex items-center justify-center h-screen">
    <div class="bg-white p-8 rounded-2xl shadow w-96">
      <h2 class="text-2xl font-bold mb-4 text-center">Login</h2>
      <input id="loginUsername" type="text" placeholder="Username" class="w-full p-2 border rounded mb-2">
      <input id="loginPassword" type="password" placeholder="Password" class="w-full p-2 border rounded mb-2">
      <button onclick="login()" class="w-full bg-blue-500 text-white p-2 rounded mb-2">Login</button>
      <p class="text-center">No account? <a href="#" onclick="showSignup()" class="text-blue-500">Sign Up</a></p>
    </div>
  </div>

  <!-- ===== Signup Page ===== -->
  <div id="signupPage" class="hidden flex items-center justify-center h-screen">
    <div class="bg-white p-8 rounded-2xl shadow w-96">
      <h2 class="text-2xl font-bold mb-4 text-center">Sign Up</h2>
      <input id="signupUsername" type="text" placeholder="Username" class="w-full p-2 border rounded mb-2">
      <input id="signupPassword" type="password" placeholder="Password" class="w-full p-2 border rounded mb-2">
      <button onclick="signup()" class="w-full bg-green-500 text-white p-2 rounded mb-2">Sign Up</button>
      <p class="text-center">Already have an account? <a href="#" onclick="showLogin()" class="text-blue-500">Login</a></p>
    </div>
  </div>

  <!-- ===== Dashboard Page ===== -->
  <div id="dashboardPage" class="hidden min-h-screen">
    <!-- Navigation -->
    <nav class="bg-white shadow flex p-4 space-x-6">
      <button onclick="showTab('overview')" class="tab-btn font-bold">Overview</button>
      <button onclick="showTab('habits')" class="tab-btn">Habits</button>
      <button onclick="showTab('workouts')" class="tab-btn">Workouts</button>
      <button onclick="showTab('meals')" class="tab-btn">Meals</button>
      <button onclick="showTab('sleep')" class="tab-btn">Sleep</button>
      <button onclick="showTab('mood')" class="tab-btn">Mood</button>
      <button onclick="showTab('friends')" class="tab-btn">Friends</button>
      <button onclick="logout()" class="ml-auto text-red-500">Logout</button>
    </nav>

    <!-- Tabs -->
    <div class="p-6">
      <div id="overviewTab" class="tab"> 
        <h2 class="text-xl font-bold mb-4">Today’s Overview</h2>
        <canvas id="overviewChart"></canvas>
      </div>

      <div id="habitsTab" class="tab hidden">
        <h2 class="text-xl font-bold mb-2">Habits</h2>
        <textarea id="habitsInput" class="w-full p-2 border rounded" placeholder="Your habits"></textarea>
        <button onclick="saveData('habits')" class="bg-blue-500 text-white p-2 rounded mt-2">Save</button>
      </div>

      <div id="workoutsTab" class="tab hidden">
        <h2 class="text-xl font-bold mb-2">Workouts</h2>
        <textarea id="workoutsInput" class="w-full p-2 border rounded" placeholder="Your workouts"></textarea>
        <button onclick="saveData('workouts')" class="bg-blue-500 text-white p-2 rounded mt-2">Save</button>
      </div>

      <div id="mealsTab" class="tab hidden">
        <h2 class="text-xl font-bold mb-2">Meals</h2>
        <textarea id="mealsInput" class="w-full p-2 border rounded" placeholder="Your meals"></textarea>
        <button onclick="saveData('meals')" class="bg-blue-500 text-white p-2 rounded mt-2">Save</button>
      </div>

      <div id="sleepTab" class="tab hidden">
        <h2 class="text-xl font-bold mb-2">Sleep (hours)</h2>
        <input id="sleepInput" type="number" class="w-full p-2 border rounded" placeholder="Hours slept">
        <button onclick="saveData('sleep')" class="bg-blue-500 text-white p-2 rounded mt-2">Save</button>
      </div>

      <div id="moodTab" class="tab hidden">
        <h2 class="text-xl font-bold mb-2">Mood</h2>
        <input id="moodInput" type="text" class="w-full p-2 border rounded" placeholder="Your mood today">
        <button onclick="saveData('mood')" class="bg-blue-500 text-white p-2 rounded mt-2">Save</button>
      </div>

      <div id="friendsTab" class="tab hidden">
        <h2 class="text-xl font-bold mb-2">Friends</h2>
        <textarea id="friendsInput" class="w-full p-2 border rounded" placeholder="Friends you interacted with"></textarea>
        <button onclick="saveData('friends')" class="bg-blue-500 text-white p-2 rounded mt-2">Save</button>
      </div>
    </div>
  </div>

  <script>
    const API_URL = "https://health-tracker-exp.onrender.com"; // replace with your Render backend URL

    // ===== Auth Functions =====
    async function login() {
      const username = document.getElementById("loginUsername").value;
      const password = document.getElementById("loginPassword").value;

      const res = await fetch(`${API_URL}/login`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ username, password })
      });
      const data = await res.json();
      if (data.userId) {
        localStorage.setItem("userId", data.userId);
        showDashboard();
        loadUserData();
      } else {
        alert(data.error || "Login failed");
      }
    }

    async function signup() {
      const username = document.getElementById("signupUsername").value;
      const password = document.getElementById("signupPassword").value;

      const res = await fetch(`${API_URL}/register`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ username, password })
      });
      const data = await res.json();
      if (data.userId) {
        alert("Signup successful! Please login.");
        showLogin();
      } else {
        alert(data.error || "Signup failed");
      }
    }

    function logout() {
      localStorage.removeItem("userId");
      document.getElementById("dashboardPage").classList.add("hidden");
      document.getElementById("loginPage").classList.remove("hidden");
    }

    // ===== Page Navigation =====
    function showSignup() {
      document.getElementById("loginPage").classList.add("hidden");
      document.getElementById("signupPage").classList.remove("hidden");
    }
    function showLogin() {
      document.getElementById("signupPage").classList.add("hidden");
      document.getElementById("loginPage").classList.remove("hidden");
    }
    function showDashboard() {
      document.getElementById("loginPage").classList.add("hidden");
      document.getElementById("signupPage").classList.add("hidden");
      document.getElementById("dashboardPage").classList.remove("hidden");
      showTab("overview");
    }

    // ===== Tab Navigation =====
    function showTab(tab) {
      document.querySelectorAll(".tab").forEach(el => el.classList.add("hidden"));
      document.getElementById(tab + "Tab").classList.remove("hidden");
    }

    // ===== Save Data =====
    async function saveData(type) {
      const userId = localStorage.getItem("userId");
      const date = new Date().toISOString().split("T")[0];
      let payload = { userId, date };

      if (type === "habits") payload.habits = document.getElementById("habitsInput").value;
      if (type === "workouts") payload.workouts = document.getElementById("workoutsInput").value;
      if (type === "meals") payload.meals = document.getElementById("mealsInput").value;
      if (type === "sleep") payload.sleep = document.getElementById("sleepInput").value;
      if (type === "mood") payload.mood = document.getElementById("moodInput").value;
      if (type === "friends") payload.friends = document.getElementById("friendsInput").value;

      await fetch(`${API_URL}/update`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      });

      alert("✅ Saved!");
      loadUserData();
    }

    // ===== Load Data =====
    async function loadUserData() {
      const userId = localStorage.getItem("userId");
      const date = new Date().toISOString().split("T")[0];

      const res = await fetch(`${API_URL}/today/${userId}/${date}`);
      const data = await res.json();

      if (data) {
        document.getElementById("habitsInput").value = data.habits || "";
        document.getElementById("workoutsInput").value = data.workouts || "";
        document.getElementById("mealsInput").value = data.meals || "";
        document.getElementById("sleepInput").value = data.sleep || "";
        document.getElementById("moodInput").value = data.mood || "";
        document.getElementById("friendsInput").value = data.friends || "";
      }
    }
  </script>
</body>
</html>
