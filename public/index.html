<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Health Tracker</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center">

  <div id="app" class="w-full max-w-md p-6 bg-white rounded-lg shadow-md">

    <!-- Login/Signup -->
    <div id="auth-section">
      <h2 id="auth-title" class="text-2xl font-bold mb-4">Login</h2>

      <form id="auth-form" class="space-y-4">
        <input type="text" id="username" placeholder="Username" class="w-full p-2 border rounded hidden" />
        <input type="email" id="email" placeholder="Email" class="w-full p-2 border rounded" required />
        <input type="password" id="password" placeholder="Password" class="w-full p-2 border rounded" required />
        <button type="submit" class="w-full bg-blue-500 text-white p-2 rounded">Submit</button>
      </form>

      <p class="mt-4 text-center">
        <span id="toggle-auth" class="text-blue-500 cursor-pointer">Switch to Signup</span>
      </p>
    </div>

    <!-- Dashboard -->
    <div id="dashboard-section" class="hidden">
      <h2 class="text-2xl font-bold mb-4">Dashboard</h2>
      <div id="dashboard-data" class="space-y-2"></div>
      <button id="logout-btn" class="mt-4 bg-red-500 text-white p-2 rounded w-full">Logout</button>
    </div>

  </div>

<script>
let isLogin = true;
const authTitle = document.getElementById("auth-title");
const toggleAuth = document.getElementById("toggle-auth");
const usernameInput = document.getElementById("username");
const authForm = document.getElementById("auth-form");
const dashboardSection = document.getElementById("dashboard-section");
const authSection = document.getElementById("auth-section");
const dashboardData = document.getElementById("dashboard-data");
let currentUserId = null;

// Toggle Login/Signup
toggleAuth.addEventListener("click", () => {
  isLogin = !isLogin;
  if (isLogin) {
    authTitle.innerText = "Login";
    usernameInput.style.display = "none";
    toggleAuth.innerText = "Switch to Signup";
  } else {
    authTitle.innerText = "Signup";
    usernameInput.style.display = "block";
    toggleAuth.innerText = "Switch to Login";
  }
});

// Form submit
authForm.addEventListener("submit", async (e) => {
  e.preventDefault();
  const username = usernameInput.value;
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;

  const endpoint = isLogin ? "/login" : "/signup";
  const payload = isLogin ? { email, password } : { username, email, password };

  try {
    const res = await fetch(`http://localhost:5000${endpoint}`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });
    const data = await res.json();
    if (res.ok) {
      currentUserId = data.user?.id || data.userId;
      showDashboard();
    } else {
      alert(data.error || "Error occurred");
    }
  } catch (err) {
    alert("Server error: " + err.message);
  }
});

// Show dashboard
async function showDashboard() {
  authSection.style.display = "none";
  dashboardSection.style.display = "block";

  const res = await fetch(`http://localhost:5000/dashboard/${currentUserId}`);
  const data = await res.json();

  dashboardData.innerHTML = `
    <p>Habits Completed: ${data.habitsCompleted}</p>
    <p>Workouts: ${data.workouts}</p>
    <p>Meals Logged: ${data.mealsLogged}</p>
    <p>Sleep Hours: ${data.sleepHours}</p>
    <p>Mood: ${data.mood}</p>
  `;
}

// Logout
document.getElementById("logout-btn").addEventListener("click", () => {
  dashboardSection.style.display = "none";
  authSection.style.display = "block";
});
</script>

</body>
</html>
